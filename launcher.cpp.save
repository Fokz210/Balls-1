#define DEGREEMODIFIER 0.0175
#include "TXLib.h"
#include "Ball.h"
void moveBalls (Ball balls[], int bnum);
void drawBalls (Ball balls[], int bnum);
void testBalls (Ball balls[], int bnum);
void initBalls (Ball balls[], int bnum);
int main()
    {
    txCreateWindow (800, 600);
    txDisableAutoPause();
    const int bnum = 6;
    Ball balls[bnum];
    initBalls (balls, bnum);
    while (!GetAsyncKeyState (VK_ESCAPE))
        {
        moveBalls (balls, bnum);
        drawBalls (balls, bnum);
        testBalls (balls, bnum);
        drawHitTable (balls, bnum, txGetExtentX() - 250, 50, txGetExtentX() - 200, txGetExtentY()/2 - 50);
        //printf ("angle == %f\n", ABall.getAngle());
        txSleep(10);
        txSetFillColor (TX_BLACK);
        txClear();
        //txClearConsole();
        }


    return 0;
    }

void drawHitTable (Ball balls[], const int bnum, double x1, double y1, double x2, double y2, topsnum)
    {
    txSelectFont ("Times New Roman", 30);
    txSetColor (TX_WHITE, 1);
    double ysize = (y2 - y1) / topsnum;
    BallChar ballschars [bnum] = {};
    for (int i = 0; i < bnum; i++)
        {
        balls[i].makeChar(&ballschars[bnum]);
        }
    SortBallsCharacteristics (ballschars, bnum);
    txLine (x1 + 20, y1, x1 + 20, y2);
    txDrawText (x1, y1, x1 + 20, y1 + ysize, "¹");
    for (int i = 0; i < topsnum; i++)
    }


void SortBallsCharacteristics (BallChar chars[], int left, int right)
    {
    int help;
    int midel = right - left/2
    int midnum;
    while (left <= right)
        {
        midnum = chars [midel].hitnumch;
        if (!standsright (chars, left, midel))
            {
            while (standsright (chars, right, midel))
                {
                right--;
                }
            change (chars, left, right);
            if (midel == right)
                {
                midel = left;
                }
            }
        left++;
        }
    SortBallsCharacteristics (chars, left, midel);
    SortBallsCharacteristics (
    }


bool standsright (BallChar chars[], tests, mid)
    {
    if (tests < mid)
        {
        if (tests[i].hitnumch < mid) return true;
        }
    else 
        {
        if (tests[i].hitnumch > mid) return true;
        }
    return false;
    }


void change (chars[], int first, int second)
    {
    BallChar helpchar = {};
    helpchar = chars[first];
    chars[first] = chars[second];
    chars[second] = helpchar;
    }

void initBalls (Ball balls[], int bnum)
    {
    for (int i = 0; i < bnum; i++)
        {
        Ball hball ((double)(i)/(double)(bnum) * txGetExtentX(), (double)(i)/(double)(bnum) * txGetExtentY(),
                    10, (i - bnum/2) * 15, 5, RGB ((double)(i)/(double)(bnum)*255, (double)(i)/(double)(bnum)*255, (double)(i)/(double)(bnum)*255), i);
        balls[i] = hball;
        }
    }

void drawBalls (Ball balls[], int bnum)
    {
    for (int i = 0; i < bnum; i++)
        {
        balls[i].draw();
        }
    }

void testBalls (Ball balls[], int bnum)
    {
    for (int i = 0; i < bnum; i++)
        {
        balls[i].testWallHit();
        }
    }

void moveBalls (Ball balls[], int bnum)
    {
    for (int i = 0; i < bnum; i++)
        {
        balls[i].move(1);
        }
    }

